/**
 * DEEP SIGHT v6.3 â€” Dashboard Layout
 * ðŸ†• v6.3: Mobile hamburger menu + improved responsive layout
 *
 * @path src/components/layout/DashboardLayout.tsx
 */

import React, { useState } from "react";
import { Outlet, useNavigate } from "react-router-dom";
import { Menu } from "lucide-react";
import { Sidebar } from "./Sidebar";
import { BottomNav } from "./BottomNav";
import { Footer } from "../Footer";
import { useAuth } from "../../hooks/useAuth";

interface DashboardLayoutProps {
  children?: React.ReactNode;
}

export const DashboardLayout: React.FC<DashboardLayoutProps> = ({ children }) => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  const handleLogout = async () => {
    logout();
    navigate("/login");
  };

  const handleMobileMenuClose = () => {
    setMobileMenuOpen(false);
  };

  return (
    <div className="flex min-h-screen bg-bg-primary">
      {/* Mobile hamburger button */}
      <button
        onClick={() => setMobileMenuOpen(true)}
        className="lg:hidden fixed top-3 left-3 z-50 w-11 h-11 rounded-xl bg-bg-elevated/95 backdrop-blur-sm border border-border-default flex items-center justify-center text-text-secondary hover:text-text-primary hover:bg-bg-hover transition-all shadow-md active:scale-95"
        aria-label="Ouvrir le menu"
        aria-expanded={mobileMenuOpen}
      >
        <Menu className="w-5 h-5" />
      </button>

      {/* Sidebar - All screens with mobile drawer behavior */}
      <Sidebar
        mobileOpen={mobileMenuOpen}
        onMobileClose={handleMobileMenuClose}
      />

      {/* Main Content */}
      <div className="flex-1 lg:ml-[260px] flex flex-col min-h-screen">
        <main
          id="main-content"
          className="flex-1 overflow-y-auto pb-20 lg:pb-0 pt-16 lg:pt-0"
          role="main"
        >
          {children || <Outlet />}
        </main>

        {/* Footer - Desktop seulement */}
        <div className="hidden lg:block">
          <Footer />
        </div>
      </div>

      {/* BottomNav - Mobile seulement */}
      <BottomNav />
    </div>
  );
};
